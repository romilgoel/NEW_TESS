<!DOCTYPE html>
<html>
  <title>&nbsp;</title>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
		
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
		<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="cordova/cordova.js"></script>
		
		<script>
		var reqTimelag = 0;
		var AllEmpNames ;
		document.addEventListener("deviceready", onDeviceReady, false);
		
	function onDeviceReady() {
		$.mobile.defaultPageTransition   = 'none';
		$.mobile.defaultDialogTransition = 'none';
		$.mobile.buttonMarkup.hoverDelay = 0;
		var flag = localStorage["EmpListSavedFlag"] ;
	if( flag != 1 )
	{
		$.ajax({
				url : 	"https://bssqa1.tallysolutions.com/isrel45_00/modules/hrms/intranet/reports/GetCount.php",
				data : {
							strUserEventID:101
							
					    },
				beforeSend : function(){
					$.mobile.loading( 'show');
				},
				error : function(){
					alert("Error occured");
				},
				success : function(data){
					//console.log(data );
					AllEmpNames = eval(data);
					localStorage["empList"] = AllEmpNames;
					localStorage["EmpListSavedFlag"] = 1;
					console.log("Flag : "+localStorage["EmpListSavedFlag"]);
					console.log(AllEmpNames );
					
					
					var str= "";
					for(var i = 0; i < AllEmpNames.length; i++ )
					{
						str += "<li data-filtertext='"+AllEmpNames[i][0]+"'><a href='#page2' class='classEmpList'>"+AllEmpNames[i][0]+"</a><input type='hidden' value='"+AllEmpNames[i][1]+"'/></li>";	
					}
					$(".EmpList").html(str);
					$('.EmpList').listview('refresh');
					$.mobile.loading( 'hide');
					
				} 
		
	    });
	 }
	 else
	 {
	  		alert("Local Storage is set");
	  		
	  		$.mobile.loading( 'show');
	  		var str= "";
	  		var dataArr = localStorage["empList"].split(",");
	  		var count = 0;
	  		var AllEmpNames = [[0,0]];
	  		for( var i = 0; i < dataArr.length ;  )
	  		{
	  			AllEmpNames[count++] = new Array(dataArr[i++],dataArr[i++]);
	  		}
					for(var i = 0; i < AllEmpNames.length; i++ )
					{
						str += "<li data-filtertext='"+AllEmpNames[i][0]+"'><a href='#page2' class='classEmpList'>"+AllEmpNames[i][0]+"</a><input type='hidden' value='"+AllEmpNames[i][1]+"'/></li>";	
					}
					$(".EmpList").html(str);
					$('.EmpList').listview('refresh');
					//alert(AllEmpNames);
					console.log(AllEmpNames);
					$.mobile.loading( 'hide');
	 }	}
	
	$(".classEmpList").live("click",function(){
					//$(".spanEmpName").html($(this).next().val());
					
			 $.ajax({
				url : 	"https://bssqa1.tallysolutions.com/isrel45_00/modules/hrms/intranet/reports/GetCount.php",
				data : {
							strUserEventID:102,
							strEmpId : $(this).next().val()
					    },
				beforeSend : function(){
					$.mobile.loading('show');
							$(".spanEmpName")      .html("");
							$(".spanEmpId")        .html("");
							$(".spanEmpGender")    .html("");
							$(".spanEmpGrade")     .html("");
							$(".spanEmpDepartment").html("");
							$(".spanEmpTitle")	   .html("");
							$(".spanEmpLocation")  .html("");
							$(".spanEmpMobile")    .html("");
							$(".spanEmpEmail")     .html("");
				},
				error : function(){
					alert("Error occured");
				},
				success : function(data){
					
					console.log(data);
					data = eval(data);
					var i = 0;
							$(".spanEmpName")	   .html(data[i++]);
							$(".spanEmpId")		   .html(data[i++]);
							$(".spanEmpGender")    .html(data[i++]);
							$(".spanEmpGrade")     .html(data[i++]);
							$(".spanEmpTitle")     .html(data[i++]);
							$(".spanEmpLocation")  .html(data[i++]);
							$(".spanEmpDepartment").html(data[i++]);
							$(".spanEmpMobile")    .html("<a href='tel:"+data[i]+"'>"+data[i++]+"</a>");
							$(".spanEmpEmail")     .html("<a href='mailto:"+data[i]+"'>"+data[i++]+"</a>");
							
					$.mobile.loading( 'hide');
					
				} 
		
		          });
			});
	</script>
	</head>
<body>
<div data-role="page" id="page1">
			<!-- Header -->
			<div data-role="header">
				<a href="javascript:void(0)" data-role="button" data-icon="back" data-iconpos="notext" data-rel="back" data-ajax="false"></a>
				<h1>Employee Search</h1>
				<a href="../TallyESSMenu.html" data-role="button" data-icon="home" data-iconpos="notext" ></a>
			</div>
			
			<div data-role="content">
			<ul data-role="listview" class="EmpList" data-filter="true" data-filter-placeholder="Search employee..." >
			</ul>
			</div>
			<!-- /footer -->
		</div>
		
		<div data-role="page" id="page2">
			<div data-role="header">
				<a href="javascript:void(0)" data-role="button" data-icon="back" data-iconpos="notext" data-rel="back" data-ajax="false"></a>
				<h1>Employee Details</h1>
				<a href="../TallyESSMenu.html" data-role="button" data-icon="home" data-iconpos="notext" ></a>
			</div>
			
			<div>
				<ul data-role="listview" data-inset="true">
				<li data-role="list-divider" role="heading">Employee Details</li>
				<li data-icon="false">
				
				<p class="ui-li-heading"><h2>Name</h2></p>
				<p class="ui-li-desc">
					<b><span data-theme='a' class="spanEmpName">&nbsp;</span></b>
				</p>
				
				</li>
				<li data-icon="false">
					
				<p class="ui-li-heading"><h2>Employee ID</h2></p>
				<p class="ui-li-desc">
					<b><span data-theme='a' class="spanEmpId"></span></b>
				</p>
					
				</li>
					 
				<li data-icon="false">
	
				<p class="ui-li-heading"><h2>Gender</h2></p>
				<p class="ui-li-desc">
					<b><span data-theme='a' class="spanEmpGender"></span></b>
				</p> 
				</li>
					
				<li data-icon="false">
					
				<p class="ui-li-heading"><h2>Grade</h2></p>
				<p class="ui-li-desc">
					<b><span data-theme='a' class="spanEmpGrade"></span></b>
				</p>
				  
				</li>
					
				<li data-icon="false">
				
				<p class="ui-li-heading"><h2>Department</h2></p>
				<p class="ui-li-desc">
					<b><span data-theme='a' class="spanEmpDepartment"></span></b>
				</p>
				
				</li>
					
				<li data-icon="false">
					
				<p class="ui-li-heading"><h2>Title</h2></p>
				<p class="ui-li-desc">
					<b><span data-theme='a' class="spanEmpTitle"></span></b>
				</p>
				 
				</li>
					
				<li data-icon="false">
			
				<p class="ui-li-heading"><h2>Location</h2></p>
				<p class="ui-li-desc">
					<b><span data-theme='a' class="spanEmpLocation"></span></b>
				</p>
				 
				</li>
				
				<li data-icon="false">
					
				<p class="ui-li-heading"><h2>Mobile</h2></p>
				<p class="ui-li-desc">
					<b><span data-theme='a' class="spanEmpMobile"></span></b>
				</p>
				 
				</li>
				
				<li data-icon="false">
			
				<p class="ui-li-heading"><h2>Email</h2></p>
				<p class="ui-li-desc">
					<b><span data-theme='a' class="spanEmpEmail"></span></b>
				</p>
				 
				</li>
					
				
			</ul>
			</div>	
		</div>

</body>
</html>
